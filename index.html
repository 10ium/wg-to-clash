<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مبدل پیشرفته کانفیگ WireGuard</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z'%3E%3C/path%3E%3C/svg%3E" type="image/svg+xml">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <style>
        :root {
            /* Light Mode Colors */
            --bg-light: #e2e8f0; /* slate-200 */
            --card-overlay-light: rgba(248, 250, 252, 0.92); /* slate-50 with opacity */
            --text-primary-light: #1e293b; /* slate-800 */
            --text-secondary-light: #475569; /* slate-600 */
            --border-light: #cbd5e1; /* slate-300 */
            --input-bg-light: #ffffff;
            
            /* Dark Mode Colors */
            --bg-dark: #0f172a;  /* slate-900 */
            --card-overlay-dark: rgba(15, 23, 42, 0.94); /* slate-900 with opacity */
            --text-primary-dark: #f8fafc;  /* slate-50 */
            --text-secondary-dark: #cbd5e1; /* slate-300 */
            --border-dark: #334155; /* slate-700 */
            --input-bg-dark: #334155; /* slate-700 */

            /* Accent Color */
            --accent-color: #4f46e5;
        }
        html.dark { color-scheme: dark; }
        
        /* FIX: Simple background for body */
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-primary-light);
            transition: background-color 0.3s, color 0.3s;
        }
        html.dark body {
            background-color: var(--bg-dark);
            color: var(--text-primary-dark);
        }

        /* FIX: Background image and overlay applied to cards */
        .card {
            border: 1px solid var(--border-light);
            background-image:
                linear-gradient(var(--card-overlay-light), var(--card-overlay-light)),
                url('https://github.com/10ium/wg-to-clash/blob/main/background.jpg?raw=true');
            background-size: cover;
            background-position: center;
            backdrop-filter: blur(2px);
            transition: background-color 0.3s, border-color 0.3s;
        }
        html.dark .card {
            border-color: var(--border-dark);
            background-image:
                linear-gradient(var(--card-overlay-dark), var(--card-overlay-dark)),
                url('https://github.com/10ium/wg-to-clash/blob/main/background.jpg?raw=true');
        }

        .form-label { color: var(--text-secondary-light); }
        html.dark .form-label { color: var(--text-secondary-dark); }
        .form-input, .form-select { background-color: var(--input-bg-light); border: 1px solid var(--border-light); color: var(--text-primary-light); transition: background-color 0.3s, border-color 0.3s, box-shadow 0.2s; }
        html.dark .form-input, html.dark .form-select { background-color: var(--input-bg-dark); border-color: var(--border-dark); color: var(--text-primary-dark); }
        .form-input::placeholder { color: var(--text-secondary-light); opacity: 0.7; }
        html.dark .form-input::placeholder { color: var(--text-secondary-dark); opacity: 0.5; }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 2px var(--accent-color); }
        .form-input:disabled { background-color: #e2e8f0; cursor: not-allowed; }
        html.dark .form-input:disabled { background-color: #334155; opacity: 0.6; cursor: not-allowed; }
        .form-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: left 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-left: 2.5rem; }
        html.dark .form-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); }
        .form-checkbox { appearance: none; background-color: var(--input-bg-light); border: 1px solid var(--border-light); width: 1.25rem; height: 1.25rem; border-radius: 0.25rem; display: inline-block; position: relative; cursor: pointer; transition: all 0.2s; }
        html.dark .form-checkbox { background-color: var(--input-bg-dark); border-color: var(--border-dark); }
        .form-checkbox:checked { background-color: var(--accent-color); border-color: var(--accent-color); }
        .form-checkbox:checked::after { content: '✔'; position: absolute; color: white; font-size: 0.8rem; top: 50%; left: 50%; transform: translate(-50%, -50%); }
    </style>
</head>

<body class="py-10 px-4">
    <div class="max-w-4xl mx-auto">
        <header class="flex justify-between items-center mb-8 px-2">
            <h1 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-sky-500">مبدل پیشرفته WireGuard</h1>
            <button id="themeToggle" class="p-2 rounded-full hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition-colors">
                <svg id="theme-icon-dark" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
                <svg id="theme-icon-light" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.909-2.636l1.591-1.591M5.25 12H3m4.227-4.227l-1.591-1.591M12 21a9 9 0 110-18 9 9 0 010 18z" /></svg>
            </button>
        </header>

        <main class="space-y-6">
            <div class="card p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 border-r-4 border-indigo-500 pr-4">۱. ورود کانفیگ‌ها</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label for="wgConfigInput" class="form-label block text-sm font-medium mb-2">متن یا لینک اشتراک</label>
                        <textarea id="wgConfigInput" rows="8" placeholder="متن کانفیگ، لینک اشتراک یا URI را اینجا وارد کنید..." class="form-input w-full rounded-md text-sm"></textarea>
                    </div>
                    <div>
                        <label for="wgConfigFile" class="form-label block text-sm font-medium mb-2">یا آپلود فایل</label>
                        <label for="wgConfigFile" class="w-full flex flex-col items-center justify-center p-6 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-md cursor-pointer hover:bg-slate-200/50 dark:hover:bg-slate-700/50 transition-colors">
                            <svg class="w-10 h-10 mb-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <span class="text-sm text-slate-500 dark:text-slate-400">فایل‌ها را بکشید یا برای انتخاب کلیک کنید</span>
                            <input type="file" id="wgConfigFile" multiple accept=".conf,.txt,.yaml,.yml,.json" class="hidden">
                        </label>
                        <div id="fileList" class="text-xs text-slate-500 dark:text-slate-400 mt-2 space-y-1"></div>
                    </div>
                </div>
                <button id="processInputBtn" class="mt-6 w-full bg-indigo-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-indigo-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-slate-900">پردازش و افزودن به لیست</button>
            </div>

            <div id="stagedConfigsContainer" class="card p-6 rounded-xl shadow-lg hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold border-r-4 border-indigo-500 pr-4">۲. کانفیگ‌های آماده</h2>
                    <span id="configCounter" class="text-sm font-medium text-slate-500 dark:text-slate-400"></span>
                </div>
                <div id="stagedConfigsList" class="max-h-60 overflow-y-auto pr-2 -mr-2 mb-4"></div>
                <div class="flex items-center gap-4 text-sm">
                    <button id="selectAllBtn" class="font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300">انتخاب همه</button>
                    <button id="deselectAllBtn" class="font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300">لغو انتخاب همه</button>
                    <div class="flex-grow"></div>
                    <button id="clearListBtn" class="font-medium text-red-600 hover:text-red-800 dark:text-red-500 dark:hover:text-red-400">پاک کردن لیست</button>
                </div>
            </div>

            <div class="card p-6 rounded-xl shadow-lg">
                 <h2 class="text-xl font-semibold mb-6 border-r-4 border-indigo-500 pr-4">۳. تنظیمات خروجی</h2>
                 <div class="grid md:grid-cols-2 gap-x-8 gap-y-6">
                    <div>
                         <label for="amneziaOptionSelect" class="form-label block text-sm font-medium mb-2">تنظیمات AmneziaWG</label>
                         <select id="amneziaOptionSelect" class="form-select w-full rounded-md text-sm">
                            <option value="use-ui-values" selected>استفاده از پروفایل‌های انتخابی UI</option>
                            <option value="use-config-values">استفاده از مقادیر خود کانفیگ</option>
                            <option value="no-amnezia">غیرفعال کردن Amnezia</option>
                        </select>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label for="templateSelect" class="form-label block text-sm font-medium mb-2">تمپلت قوانین</label>
                            <select id="templateSelect" class="form-select w-full rounded-md text-sm">
                                <option value="full-rule-template" data-name="Full" selected>قوانین کامل</option>
                                <option value="iran-template" data-name="Iran">قوانین ایران</option>
                                <option value="no-rule-template" data-name="NoRules">بدون قوانین</option>
                            </select>
                        </div>
                        <div>
                            <label for="outputFileName" class="form-label block text-sm font-medium mb-2">نام فایل خروجی</label>
                            <input type="text" id="outputFileName" class="form-input w-full rounded-md text-sm">
                        </div>
                    </div>
                    <div id="amneziaProfilesWrapper" class="transition-opacity duration-300 md:col-span-2">
                        <label class="block text-sm font-semibold mb-3 text-slate-700 dark:text-slate-100">پروفایل‌های AmneziaWG (انتخاب چندتایی)</label>
                        <div id="amneziaProfilesContainer" class="space-y-2.5 text-sm"></div>
                        <div id="customProfileInputs" class="hidden mt-4 space-y-2 p-3 bg-slate-200/50 dark:bg-slate-700/50 rounded-lg">
                            <div class="grid grid-cols-3 gap-2">
                                <div><label for="jcInput" class="form-label block text-xs mb-1">jc</label><input type="number" id="jcInput" value="4" min="0" class="form-input w-full rounded text-sm p-2"></div>
                                <div><label for="jminInput" class="form-label block text-xs mb-1">jmin</label><input type="number" id="jminInput" value="40" min="0" class="form-input w-full rounded text-sm p-2"></div>
                                <div><label for="jmaxInput" class="form-label block text-xs mb-1">jmax</label><input type="number" id="jmaxInput" value="250" min="0" class="form-input w-full rounded text-sm p-2"></div>
                            </div>
                        </div>
                    </div>
                 </div>
                 <button id="generateBtn" class="mt-8 w-full bg-emerald-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-emerald-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 dark:focus:ring-offset-slate-900 text-base">تولید و دانلود فایل</button>
            </div>
            
            <div id="errorDetailsContainer" class="hidden card p-4 border-red-400/50 bg-red-50 dark:bg-red-900/50">
                <h3 class="font-semibold text-base text-red-800 dark:text-red-300 mb-2">جزئیات خطاها:</h3>
                <ul id="errorList" class="list-disc list-inside text-sm space-y-1 text-red-700 dark:text-red-400"></ul>
            </div>
        </main>
    </div>
    <script type="module" src="script.js"></script>
</body>
</html>
